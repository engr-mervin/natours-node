var e,t,o,n;let a;const s=function(){var e;let t=document.querySelector(".alert");t&&(null===(e=t.parentElement)||void 0===e||e.removeChild(t))},i=function(e,t){var o;a&&clearTimeout(a),s();let n=`<div class="alert alert--${e}">${t}</div>`;null===(o=document.querySelector("body"))||void 0===o||o.insertAdjacentHTML("afterbegin",n),a=setTimeout(()=>{s()},1500)},l=async function(e,...t){try{return i("success","Please wait..."),await e(...t)}catch(e){i("error",e.message)}},r=async function(e,t){let o=JSON.stringify({email:e||"",password:t||""}),n=await fetch(`${process.env.DEV_URL}/api/v1/users/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:o}),a=await n.json();if(a.error)throw a;i("success","Logged in successfully"),setTimeout(()=>{window.location.href=`${process.env.DEV_URL}/`},1500)},d=async function(e){let t=await fetch(`${process.env.DEV_URL}/api/v1/users/updateMyInfo`,{method:"PATCH",body:e}),o=await t.json();if("success"!==o.status)throw o;i("success","Updated Data Successfully"),setTimeout(()=>{window.location.href=`${process.env.DEV_URL}/me`},1500)},c=async function(e){let t=JSON.stringify(e),o=await fetch(`${process.env.DEV_URL}/api/v1/users/updatePassword`,{headers:{"Content-Type":"application/json"},method:"PATCH",body:t}),n=await o.json();if("success"!==n.status)throw n;i("success","Updated Data Successfully")},u=async function(e){let t=await fetch(`${process.env.DEV_URL}/api/v1/bookings/checkout-session/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}}),o=await t.json();window.location.href=o.session.url},p=document.querySelector(".error__title"),m=Number(null==p?void 0:null===(e=p.dataset)||void 0===e?void 0:e.status),v=document.querySelector(".form--login"),f=(null===(o=document)||void 0===o?void 0:null===(t=o.getElementById("map"))||void 0===t?void 0:t.dataset.locations)||"",y=f?JSON.parse(f):null,h=null===(n=document)||void 0===n?void 0:n.getElementById("book-tour");if(h){let e=h.dataset.tourId;h.addEventListener("click",t=>{t.preventDefault(),l(u,e)})}if(v){let e=document.getElementById("password"),t=document.getElementById("email");null==v||v.addEventListener("submit",o=>{o.preventDefault(),l(r,t.value,e.value)})}y&&function(e){let t=L.icon({iconUrl:"../img/pin.png",iconSize:[20,25],iconAnchor:[10,25],popupAnchor:[0,-25]}),o=L.map("map",{center:[34.111745,-118.113491],zoomControl:!1,dragging:!1});L.tileLayer("https://tiles.stadiamaps.com/tiles/alidade_smooth/{z}/{x}/{y}{r}.{ext}",{attribution:'&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a> &copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',ext:"png"}).addTo(o);let n=e.map(e=>{let n=[e.coordinates[1],e.coordinates[0]];return L.marker(n,{icon:t}).addTo(o).bindPopup(`<p>Day ${e.day}: ${e.description}</p>`,{autoClose:!1}).openPopup(),n}),a=L.latLngBounds(n).pad(.2);o.fitBounds(a),o.scrollWheelZoom.disable()}(y),m&&401===m&&(i("error","Redirecting to login page..."),setTimeout(()=>{window.location.href="/login"},3e3));const g=document.querySelector(".form-user-data");if(g){let e=document.getElementById("email"),t=document.getElementById("name"),o=document.getElementById("photo");o&&o.addEventListener("change",function(e){var t;let o=document.querySelector(".form__user-photo");(null===this||void 0===this?void 0:null===(t=this.files)||void 0===t?void 0:t.length)&&(o.src=URL.createObjectURL(this.files[0]),o.onload=function(){URL.revokeObjectURL(o.src)})}),g.addEventListener("submit",n=>{n.preventDefault();let a=new FormData;a.append("name",t.value),a.append("email",e.value),(null==o?void 0:o.files)&&o.files[0]&&a.append("photo",o.files[0]),l(d,a)})}const w=document.querySelector(".form-user-settings");if(w){let e=document.getElementById("password-current"),t=document.getElementById("password"),o=document.getElementById("password-confirm");w.addEventListener("submit",async n=>{n.preventDefault(),await l(c,{currentPassword:(null==e?void 0:e.value)||"",password:(null==t?void 0:t.value)||"",passwordConfirm:(null==o?void 0:o.value)||""}),e.value="",t.value="",o.value=""})}
//# sourceMappingURL=index.js.map
